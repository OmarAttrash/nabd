<link rel="import" href="bower_components/iron-pages/iron-pages.html">
<link rel="import" href="components/o-parse/o-parse-connect.html"></script>
<link rel="import" href="components/o-parse/o-parse-login-button.html"></script>
<link rel="import" href="components/o-parse/o-parse-pulls.html"></script>
<link rel="import" href="bower_components/polymer/polymer.html">

<dom-module id="o-pull-app">
	<template>
		<o-parse-connect></o-parse-connect>
		<iron-pages id="pages" selected="{{page}}">
			<div><o-parse-login-button logged="{{userStatus}}" id="login"></o-parse-login-button></div>
			<div><o-parse-pulls></o-parse-pulls></div>
			<div>
				<h1>{{selectedPull}}</h1>			
				<div id="comments"></div>
			</div>
		</iron-pages>
	</template>
	<script>
		Polymer({
			is:"o-pull-app",
			properties:{
				commentsLoaded:false
				}
			ready:function(){
				this.loging();
				var root = this;
				this.$.login.addEventListener('logged',function(){
					root.loging();
				});
				
				window.addEventListener("hashchange",function(){
					if(window.location.hash) {
						root.selectedPull = window.location.hash.substring(1);
						root.$.pages.selected = 2;
					} 
					else{
						root.$.pages.selected = 1;
					}
				});
			},
			loging : function(){
				if(this.userStatus === true){
					this.$.pages.selected = 1;
					if(window.location.hash) {
						this.selectedPull = window.location.hash.substring(1);
						this.$.pages.selected = 2;
					} 
				}
			},
			calculateUrl: function(s){
				console.log(s);
				return "https://omarattrash.github.io/nabd/#" + s ;
				//return "https://omarattrash.github.io/nabd/?pull=" + s ;
			},
			pageChanged:function(newVal,oldVal){
				if(newVal == 2 && !commentsLoaded){
					this.$.comments.innerHTML = '<div class="fb-comments" data-href="'+this.calculateUrl(this.selectedPull)+'" data-numposts="5"></div>';	
				}
			}
		});
	</script>
</dom-module>