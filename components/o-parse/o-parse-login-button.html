<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="o-parse-login-button">
	<style>
		p{
			display:none;
		}
	</style>
	<template>
		<button id="loggin" on-click="loginFacebook">Facebook login</button>
		<p>{{userName}}</p>
	</template>
	
<script>
	Polymer({
		is:"o-parse-login-button",
		properties:{
			logged:{
				type:Boolean,
				value:false
			},
			userName:{
				type:String
			}
		},
		ready: function(){
			if (typeof Parse === 'undefined') {
				console.log("Using o-parse-login-button require initing the Parse elsewhere. check if o-parse-connect element inculded before this element");
				return;
			}
			window.fbAsyncInit = function() {
			Parse.FacebookUtils.init({
				appId      : '138466529835768',
				status     : true,  // check Facebook Login status
				cookie     : true,  // enable cookies to allow Parse to access the session
				xfbml      : true,
				version    : 'v2.4'
			});
			};
			 var js, fjs = document.getElementsByTagName('script')[0];
			 if (document.getElementById('facebook-jssdk')) {return;}
			 js = document.createElement('script'); js.id = 'facebook-jssdk';
			 js.src = "//connect.facebook.net/en_US/sdk.js";
			 fjs.parentNode.insertBefore(js, fjs);
			 
			 
			
			  if (Parse.User.current() != null) {
				this.logged = true ;
			  }else{
				this.logged = false ;
			  }
		   if(this.logged){
			this.$.loggin.style.display = 'none';
		   }
		},
		
		loginFacebook: function(){		
			if(this.logged){
				console.log("Something went tirrable");
				return;
			}
			Parse.FacebookUtils.logIn("public_profile,email", {
				success: function(user) {
					if (!user.existed()) {
					  alert("User signed up and logged in through Facebook!");
					} else {
					  alert("User logged in through Facebook!");
					}
				},
				error: function(user, error) {
					alert("User cancelled the Facebook login or did not fully authorize.");
				}
			});
		}
	});
</script>
	
</dom-module>
