<!DOCTYPE html>
<html>
	<head>
		<title>
			nabd testing
		</title>
		  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
		<script src="//www.parsecdn.com/js/parse-1.5.0.min.js"></script>
	</head>
	<body>
			<input type="text" id="question"/>
			<input type="checkbox" id="multi" value="multichoice">multichoice
			<hr>
			<div id="answers">
				<input type="text" class="answer"/>
				<input type="text" class="answer"/>
			</div>
			<button id="more">More</button>
			<button id="add">Add</button>
		<script>
			$(document).ready(function(){
			
				  window.fbAsyncInit = function() {
					FB.init({
					  appId      : '138466529835768',
					  cookie     : true,
					  xfbml      : true,
					  version    : 'v2.4'
					});
				  };

				  (function(d, s, id){
					 var js, fjs = d.getElementsByTagName(s)[0];
					 if (d.getElementById(id)) {return;}
					 js = d.createElement(s); js.id = id;
					 js.src = "//connect.facebook.net/en_US/sdk.js";
					 fjs.parentNode.insertBefore(js, fjs);
				   }(document, 'script', 'facebook-jssdk'));
			
				Parse.initialize("KOqXqY8Sovm20CmDXxPquj1en91Bn5cAmteeoBG8", "NIXpiZJmKu3M26AQQIHO0fc7qWJZIpMdl9VYwCPy");
				$("#more").on("click",function(){
					$( "#answers" ).append( '<input type="text" class="answer"/>' );
				});
				$("#add").on("click",function(){
					var Pull = Parse.Object.extend("Pull");
					var pull = new Pull();
					var answersInputs = $(".answer").toArray();
					var answers = [];
					for(var i=0;i<answersInputs.length;i++){
						answers.push($(answersInputs[i]).val());
					}
					pull.save({
					  question: $("#question").val(),
					  answers: answers,
					  multi: document.getElementById("multi").checked
					}, {
					  success: function(pull) {
						alert("Saved");
						console.dir(pull);
						$( "#answers" ).html('<input type="text" class="answer"/><input type="text" class="answer"/>');
						$("input[type=text]").val('');
						$('#multi').prop('checked', false);
						var getAllUsers = new Parse.Query(Parse.User);
						getAllUsers.find({success:function(items){
							alert(items.length);
							$.each(items,function(i,item){
							//alert(i+":"+JSON.stringify(item));
							console.dir(item);
							console.log(item.attributes.authData.facebook.id);
							FB.api(
								"/"+item.attributes.authData.facebook.id+"/notifications",
								"post",
								{
									template:"Hi there",
									href:"#",
									access_token: item.attributes.authData.facebook.access_token
								},
								function (response) {
									console.dir(response);
								}
							);
							});
							
						}});
					  },
					  error: function(pull, error) {
						console.log(error);
					  }
					});
				});
			});
		</script>
	</body>
</html>